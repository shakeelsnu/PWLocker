<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Locker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://unpkg.com/libphonenumber-js@1.10.25/bundle/libphonenumber-js.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6" id="auth-container">
    <h1 class="text-2xl font-bold mb-4 text-center">Password Locker</h1>
    <div id="login-section">
      <label class="block mb-2">Mobile Number</label>
      <input type="tel" id="mobileInput" placeholder="+97412345678" class="w-full p-2 border rounded mb-2" />
      <p id="mobileError" class="text-red-500 text-sm hidden">Invalid mobile number</p>

      <label class="block mb-2">Password</label>
      <input type="password" id="passwordInput" placeholder="Password" class="w-full p-2 border rounded mb-4" />

      <label class="block mb-2">Email (for password recovery)</label>
      <input type="email" id="emailInput" placeholder="you@example.com" class="w-full p-2 border rounded mb-4" />

      <button id="loginBtn" class="w-full bg-blue-500 text-white p-2 rounded mb-2">Login</button>
      <button id="googleBtn" class="w-full bg-red-500 text-white p-2 rounded mb-2">Sign in with Google</button>
      <button id="signupBtn" class="w-full bg-green-500 text-white p-2 rounded mb-2">Sign Up</button>
      <button id="forgotBtn" class="w-full bg-yellow-500 text-black p-2 rounded">Forgot Password</button>
    </div>

    <div id="password-manager" class="hidden">
      <h2 class="text-xl font-bold mb-4">Saved Passwords</h2>
      <div id="savedList" class="space-y-2"></div>
      <button id="exportBtn" class="w-full bg-purple-500 text-white p-2 rounded mt-4">Export All (ZIP: JSON + TXT)</button>
      <input type="file" id="importFile" accept=".zip" class="hidden" />
      <button id="importBtn" class="w-full bg-yellow-500 text-white p-2 rounded mt-2">Import (ZIP)</button>
    </div>
  </div>

  <div id="toast-container" class="fixed bottom-4 right-4 space-y-2 z-50"></div>

  <script>
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const googleBtn = document.getElementById('googleBtn');
    const forgotBtn = document.getElementById('forgotBtn');
    const mobileInput = document.getElementById('mobileInput');
    const passwordInput = document.getElementById('passwordInput');
    const emailInput = document.getElementById('emailInput');
    const mobileError = document.getElementById('mobileError');

    const passwordManager = document.getElementById('password-manager');
    const savedList = document.getElementById('savedList');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');

    let savedPasswords = JSON.parse(localStorage.getItem('savedPasswords')) || [];

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `p-3 rounded shadow text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
      toast.innerText = message;
      document.getElementById('toast-container').appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function validateMobile(number) {
      try {
        const parsed = libphonenumber.parsePhoneNumber(number);
        return parsed.isValid();
      } catch (e) {
        return false;
      }
    }

    function renderPasswords() {
      savedList.innerHTML = '';
      savedPasswords.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'border p-2 rounded bg-gray-50';
        div.innerHTML = `
          <p><strong>Website:</strong> ${item.website}</p>
          <p><strong>Username:</strong> ${item.username}</p>
          <p><strong>Password:</strong> ${item.password}</p>
          <button class="bg-red-500 text-white px-2 py-1 rounded mt-2" onclick="deletePassword(${idx})">Delete</button>
        `;
        savedList.appendChild(div);
      });
    }

    function deletePassword(idx) {
      if (confirm('Should I delete this saved password?')) {
        savedPasswords.splice(idx, 1);
        localStorage.setItem('savedPasswords', JSON.stringify(savedPasswords));
        renderPasswords();
        showToast('Deleted successfully');
      }
    }

    loginBtn.onclick = () => {
      const mobile = mobileInput.value.trim();
      const pw = passwordInput.value.trim();
      if (!validateMobile(mobile)) { mobileError.classList.remove('hidden'); return; }
      mobileError.classList.add('hidden');

      const storedPw = localStorage.getItem(`pw_${mobile}`);
      if (storedPw && storedPw === pw) {
        document.getElementById('login-section').classList.add('hidden');
        passwordManager.classList.remove('hidden');
        renderPasswords();
        showToast('Login successful');
      } else {
        showToast('Wrong password', 'error');
      }
    };

    signupBtn.onclick = () => {
      const mobile = mobileInput.value.trim();
      const pw = passwordInput.value.trim();
      const email = emailInput.value.trim();

      if (!validateMobile(mobile)) { mobileError.classList.remove('hidden'); return; }
      mobileError.classList.add('hidden');
      if (!email) { showToast('Email required', 'error'); return; }

      if (pw.length < 4 || pw.length > 6) { showToast('Password must be 4â€“6 digits', 'error'); return; }

      localStorage.setItem(`pw_${mobile}`, pw);
      localStorage.setItem(`email_${mobile}`, email);
      showToast('Signed up successfully');
    };

    forgotBtn.onclick = () => {
      const mobile = mobileInput.value.trim();
      if (!validateMobile(mobile)) { mobileError.classList.remove('hidden'); return; }
      mobileError.classList.add('hidden');
      const email = localStorage.getItem(`email_${mobile}`);
      const pw = localStorage.getItem(`pw_${mobile}`);
      if (email && pw) {
        alert(`Password sent to ${email}: ${pw}`); // Replace with actual email sending in production
      } else {
        showToast('No password found for this mobile', 'error');
      }
    };

    googleBtn.onclick = () => {
      showToast('Redirecting to Google sign-in...');
      // Here integrate proper Google OAuth2 flow using gsi client or Firebase OAuth
    };

    exportBtn.onclick = () => {
      const zip = new JSZip();
      const jsonData = JSON.stringify(savedPasswords, null, 2);
      const txtData = savedPasswords.map(p => `Website: ${p.website}\nUsername: ${p.username}\nPassword: ${p.password}`).join('\n\n');
      zip.file('data.json', jsonData);
      zip.file('data.txt', txtData);
      zip.generateAsync({ type: 'blob' }).then(content => saveAs(content, 'passwords.zip'));
      showToast('Exported as ZIP');
    };

    importBtn.onclick = () => importFile.click();
    importFile.onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      JSZip.loadAsync(file).then(zip => zip.file('data.json').async('string'))
        .then(jsonStr => {
          savedPasswords = JSON.parse(jsonStr);
          localStorage.setItem('savedPasswords', JSON.stringify(savedPasswords));
          renderPasswords();
          showToast('Imported successfully');
        }).catch(() => showToast('Import failed', 'error'));
    };

    window.addEventListener('DOMContentLoaded', () => {
      const saved = JSON.parse(localStorage.getItem('autoLogin') || 'null');
      if (saved) {
        mobileInput.value = saved.mobile;
       
